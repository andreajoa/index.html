<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolo ABC Neurodivergente - An√°lise Comportamental Inteligente</title>
    <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2d3748;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6b7280;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.9);
            color: #4f46e5;
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #4f46e5;
            display: block;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .main-form {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            margin-bottom: 40px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-section {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            border-left: 4px solid #4f46e5;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .analysis-result {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .severity-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .severity-low { background: #dcfce7; color: #166534; }
        .severity-medium { background: #fef3c7; color: #92400e; }
        .severity-high { background: #fee2e2; color: #991b1b; }

        .recommendations {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .patient-list {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .patient-card {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .patient-card:hover {
            transform: translateY(-3px);
        }

        .patient-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .patient-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e293b;
        }

        .patient-id {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            transition: width 0.3s ease;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .behavior-timeline {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid #4f46e5;
        }

        .timeline-time {
            font-weight: 600;
            color: #4f46e5;
            min-width: 80px;
        }

        .timeline-content {
            flex: 1;
        }

        .ai-insights {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .ai-insights h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .intervention-card {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .tag {
            display: inline-block;
            background: #e0e7ff;
            color: #4338ca;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 2px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .export-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Protocolo ABC Neurodivergente</h1>
            <p class="subtitle">An√°lise Comportamental Inteligente com IA para Profissionais</p>
            
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
                <button class="nav-tab" onclick="switchTab('analysis')">üîç Nova An√°lise</button>
                <button class="nav-tab" onclick="switchTab('patients')">üë• Pacientes</button>
                <button class="nav-tab" onclick="switchTab('reports')">üìà Relat√≥rios</button>
                <button class="nav-tab" onclick="switchTab('interventions')">üéØ Interven√ß√µes</button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="quick-stats">
                <div class="stat-card">
                    <span class="stat-number" id="totalPatients">24</span>
                    <div class="stat-label">Pacientes Ativos</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalAnalyses">156</span>
                    <div class="stat-label">An√°lises Realizadas</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="avgProgress">78%</span>
                    <div class="stat-label">Progresso M√©dio</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="activeInterventions">12</span>
                    <div class="stat-label">Interven√ß√µes Ativas</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìà Evolu√ß√£o Comportamental - √öltimos 30 dias</h3>
                <canvas id="progressChart" width="400" height="200"></canvas>
            </div>

            <div class="ai-insights">
                <h3>ü§ñ Insights da IA</h3>
                <p>Baseado nos dados coletados, identificamos padr√µes comportamentais que sugerem maior efic√°cia das interven√ß√µes durante o per√≠odo matutino. Recomendamos ajustar os hor√°rios das atividades terap√™uticas.</p>
            </div>
        </div>

        <!-- Analysis Tab -->
        <div id="analysis" class="tab-content">
            <div class="main-form">
                <form id="abcForm">
                    <div class="form-grid">
                        <!-- Informa√ß√µes do Paciente -->
                        <div class="form-section">
                            <h3 class="section-title">üë§ Informa√ß√µes do Paciente</h3>
                            <div class="form-group">
                                <label for="patientName">Nome do Paciente</label>
                                <input type="text" id="patientName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="patientAge">Idade</label>
                                <input type="number" id="patientAge" class="form-control" min="1" max="100" required>
                            </div>
                            <div class="form-group">
                                <label for="diagnosis">Diagn√≥stico/Condi√ß√£o</label>
                                <select id="diagnosis" class="form-control" required>
                                    <option value="">Selecione...</option>
                                    <option value="autism">Transtorno do Espectro Autista</option>
                                    <option value="adhd">TDAH</option>
                                    <option value="intellectual">Defici√™ncia Intelectual</option>
                                    <option value="anxiety">Transtorno de Ansiedade</option>
                                    <option value="other">Outro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="environment">Ambiente</label>
                                <select id="environment" class="form-control" required>
                                    <option value="">Selecione...</option>
                                    <option value="home">Casa</option>
                                    <option value="school">Escola</option>
                                    <option value="clinic">Cl√≠nica</option>
                                    <option value="community">Comunidade</option>
                                </select>
                            </div>
                        </div>

                        <!-- Antecedente (A) -->
                        <div class="form-section">
                            <h3 class="section-title">üîç Antecedente (A)</h3>
                            <div class="form-group">
                                <label for="timeOfDay">Hor√°rio do Dia</label>
                                <input type="time" id="timeOfDay" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="activity">Atividade em Curso</label>
                                <input type="text" id="activity" class="form-control" placeholder="Ex: Aula de matem√°tica, hora do lanche..." required>
                            </div>
                            <div class="form-group">
                                <label for="peoplePresent">Pessoas Presentes</label>
                                <input type="text" id="peoplePresent" class="form-control" placeholder="Ex: Professor, colegas, fam√≠lia...">
                            </div>
                            <div class="form-group">
                                <label for="environmentalFactors">Fatores Ambientais</label>
                                <textarea id="environmentalFactors" class="form-control" placeholder="Ru√≠do, ilumina√ß√£o, temperatura, mudan√ßas na rotina..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="triggers">Poss√≠veis Gatilhos</label>
                                <textarea id="triggers" class="form-control" placeholder="Demandas, transi√ß√µes, frustra√ß√µes..."></textarea>
                            </div>
                        </div>

                        <!-- Comportamento (B) -->
                        <div class="form-section">
                            <h3 class="section-title">‚ö° Comportamento (B)</h3>
                            <div class="form-group">
                                <label for="behaviorType">Tipo de Comportamento</label>
                                <select id="behaviorType" class="form-control" required>
                                    <option value="">Selecione...</option>
                                    <option value="aggression">Agress√£o</option>
                                    <option value="self-injury">Autoles√£o</option>
                                    <option value="tantrum">Birra/Crise</option>
                                    <option value="stereotypy">Estereotipia</option>
                                    <option value="elopement">Fuga</option>
                                    <option value="non-compliance">N√£o-conformidade</option>
                                    <option value="other">Outro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="behaviorDescription">Descri√ß√£o Detalhada</label>
                                <textarea id="behaviorDescription" class="form-control" placeholder="Descreva o comportamento de forma objetiva e espec√≠fica..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="intensity">Intensidade (1-10)</label>
                                <input type="range" id="intensity" class="form-control" min="1" max="10" value="5" oninput="updateIntensityValue(this.value)">
                                <span id="intensityValue">5</span>
                            </div>
                            <div class="form-group">
                                <label for="duration">Dura√ß√£o (minutos)</label>
                                <input type="number" id="duration" class="form-control" min="0" step="0.5" required>
                            </div>
                            <div class="form-group">
                                <label for="frequency">Frequ√™ncia Hoje</label>
                                <input type="number" id="frequency" class="form-control" min="1" required>
                            </div>
                        </div>

                        <!-- Consequ√™ncia (C) -->
                        <div class="form-section">
                            <h3 class="section-title">üéØ Consequ√™ncia (C)</h3>
                            <div class="form-group">
                                <label for="immediateResponse">Resposta Imediata</label>
                                <textarea id="immediateResponse" class="form-control" placeholder="Como as pessoas reagiram? O que aconteceu logo ap√≥s?" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="obtainedAttention">Aten√ß√£o Obtida</label>
                                <select id="obtainedAttention" class="form-control">
                                    <option value="none">Nenhuma</option>
                                    <option value="positive">Aten√ß√£o Positiva</option>
                                    <option value="negative">Aten√ß√£o Negativa</option>
                                    <option value="peer">Aten√ß√£o dos Pares</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="escapedTask">Escapou de Tarefa/Demanda?</label>
                                <select id="escapedTask" class="form-control">
                                    <option value="no">N√£o</option>
                                    <option value="yes">Sim</option>
                                    <option value="partial">Parcialmente</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="accessedItem">Acessou Item/Atividade Desejada?</label>
                                <select id="accessedItem" class="form-control">
                                    <option value="no">N√£o</option>
                                    <option value="yes">Sim</option>
                                    <option value="delayed">Com Atraso</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sensoryOutcome">Resultado Sensorial</label>
                                <textarea id="sensoryOutcome" class="form-control" placeholder="Estimula√ß√£o sensorial obtida, mudan√ßa no ambiente..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary" style="margin-right: 10px;">üîç Analisar Comportamento</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">üóëÔ∏è Limpar Formul√°rio</button>
                    </div>
                </form>

                <div id="analysisResult" class="analysis-result" style="display: none;">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>

        <!-- Patients Tab -->
        <div id="patients" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üë• Gerenciamento de Pacientes</h2>
                <button class="btn btn-primary" onclick="openModal('addPatientModal')">‚ûï Novo Paciente</button>
            </div>
            
            <div class="patient-list" id="patientList">
                <!-- Patient cards will be populated here -->
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>üìà Relat√≥rios e An√°lises</h2>
            
            <div class="form-grid" style="margin-top: 30px;">
                <div class="form-section">
                    <h3 class="section-title">üìä Gerar Relat√≥rio</h3>
                    <div class="form-group">
                        <label for="reportPatient">Paciente</label>
                        <select id="reportPatient" class="form-control">
                            <option value="all">Todos os Pacientes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportPeriod">Per√≠odo</label>
                        <select id="reportPeriod" class="form-control">
                            <option value="week">√öltima Semana</option>
                            <option value="month">√öltimo M√™s</option>
                            <option value="quarter">√öltimo Trimestre</option>
                            <option value="custom">Per√≠odo Personalizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportType">Tipo de Relat√≥rio</label>
                        <select id="reportType" class="form-control">
                            <option value="summary">Resumo Executivo</option>
                            <option value="detailed">An√°lise Detalhada</option>
                            <option value="progress">Progresso Comportamental</option>
                            <option value="interventions">Efic√°cia das Interven√ß√µes</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="generateReport()">üìã Gerar Relat√≥rio</button>
                </div>

                <div class="form-section">
                    <h3 class="section-title">üì§ Exportar Dados</h3>
                    <div class="export-options">
                        <button class="btn btn-success" onclick="exportData('pdf')">üìÑ PDF</button>
                        <button class="btn btn-success" onclick="exportData('excel')">üìä Excel</button>
                        <button class="btn btn-success" onclick="exportData('csv')">üìã CSV</button>
                    </div>
                </div>
            </div>

            <div id="reportResults" class="chart-container" style="display: none;">
                <h3>üìà Resultados do Relat√≥rio</h3>
                <div id="reportContent"></div>
            </div>
        </div>

        <!-- Interventions Tab -->
        <div id="interventions" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üéØ Banco de Interven√ß√µes</h2>
                <button class="btn btn-primary" onclick="openModal('addInterventionModal')">‚ûï Nova Interven√ß√£o</button>
            </div>

            <div id="interventionsList">
                <!-- Interventions will be populated here -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="addPatientModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('addPatientModal')">&times;</span>
            <h3>‚ûï Adicionar Novo Paciente</h3>
            <form id="addPatientForm">
                <div class="form-group">
                    <label for="newPatientName">Nome Completo</label>
                    <input type="text" id="newPatientName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newPatientAge">Idade</label>
                    <input type="number" id="newPatientAge" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newPatientDiagnosis">Diagn√≥stico</label>
                    <select id="newPatientDiagnosis" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="autism">Transtorno do Espectro Autista</option>
                        <option value="adhd">TDAH</option>
                        <option value="intellectual">Defici√™ncia Intelectual</option>
                        <option value="anxiety">Transtorno de Ansiedade</option>
                        <option value="other">Outro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newPatientNotes">Observa√ß√µes</label>
                    <textarea id="newPatientNotes" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">üíæ Salvar Paciente</button>
            </form>
        </div>
    </div>

    <div id="addInterventionModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('addInterventionModal')">&times;</span>
            <h3>üéØ Nova Interven√ß√£o</h3>
            <form id="addInterventionForm">
                <div class="form-group">
                    <label for="interventionName">Nome da Interven√ß√£o</label>
                    <input type="text" id="interventionName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="interventionCategory">Categoria</label>
                    <select id="interventionCategory" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="behavioral">Comportamental</option>
                        <option value="communication">Comunica√ß√£o</option>
                        <option value="social">Habilidades Sociais</option>
                        <option value="sensory">Sensorial</option>
                        <option value="academic">Acad√™mica</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="interventionDescription">Descri√ß√£o</label>
                    <textarea id="interventionDescription" class="form-control" required></textarea>
                </div>
                <div class="form-group">
                    <label for="interventionSteps">Passos da Implementa√ß√£o</label>
                    <textarea id="interventionSteps" class="form-control" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">üíæ Salvar Interven√ß√£o</button>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let patients = JSON.parse(localStorage.getItem('patients')) || [];
        let analyses = JSON.parse(localStorage.getItem('analyses')) || [];
        let interventions = JSON.parse(localStorage.getItem('interventions')) || [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadPatients();
            loadInterventions();
            updateDashboardStats();
            drawProgressChart();
        });

        function initializeApp() {
            // Add sample data if none exists
            if (patients.length === 0) {
                patients = [
                    {
                        id: 1,
                        name: "Jo√£o Silva",
                        age: 8,
                        diagnosis: "autism",
                        progress: 75,
                        lastSession: "2024-01-15",
                        notes: "Progresso significativo em comunica√ß√£o"
                    },
                    {
                        id: 2,
                        name: "Maria Santos",
                        age: 12,
                        diagnosis: "adhd",
                        progress: 60,
                        lastSession: "2024-01-14",
                        notes: "Melhorias na aten√ß√£o sustentada"
                    }
                ];
                localStorage.setItem('patients', JSON.stringify(patients));
            }

            if (interventions.length === 0) {
                interventions = [
                    {
                        id: 1,
                        name: "Refor√ßo Diferencial",
                        category: "behavioral",
                        description: "T√©cnica para reduzir comportamentos inadequados atrav√©s do refor√ßo de comportamentos alternativos",
                        steps: "1. Identificar comportamento alvo\n2. Definir comportamento alternativo\n3. Aplicar refor√ßo consistente\n4. Monitorar progresso"
                    },
                    {
                        id: 2,
                        name: "Comunica√ß√£o Visual",
                        category: "communication",
                        description: "Uso de s√≠mbolos visuais para facilitar a comunica√ß√£o",
                        steps: "1. Avaliar n√≠vel de compreens√£o\n2. Selecionar s√≠mbolos apropriados\n3. Ensinar uso gradual\n4. Generalizar para diferentes contextos"
                    }
                ];
                localStorage.setItem('interventions', JSON.stringify(interventions));
            }
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Form handling
        document.getElementById('abcForm').addEventListener('submit', function(e) {
            e.preventDefault();
            analyzeABCData();
        });

        function analyzeABCData() {
            const formData = {
                patientName: document.getElementById('patientName').value,
                patientAge: document.getElementById('patientAge').value,
                diagnosis: document.getElementById('diagnosis').value,
                environment: document.getElementById('environment').value,
                timeOfDay: document.getElementById('timeOfDay').value,
                activity: document.getElementById('activity').value,
                peoplePresent: document.getElementById('peoplePresent').value,
                environmentalFactors: document.getElementById('environmentalFactors').value,
                triggers: document.getElementById('triggers').value,
                behaviorType: document.getElementById('behaviorType').value,
                behaviorDescription: document.getElementById('behaviorDescription').value,
                intensity: document.getElementById('intensity').value,
                duration: document.getElementById('duration').value,
                frequency: document.getElementById('frequency').value,
                immediateResponse: document.getElementById('immediateResponse').value,
                obtainedAttention: document.getElementById('obtainedAttention').value,
                escapedTask: document.getElementById('escapedTask').value,
                accessedItem: document.getElementById('accessedItem').value,
                sensoryOutcome: document.getElementById('sensoryOutcome').value,
                timestamp: new Date().toISOString()
            };

            // Save analysis
            analyses.push(formData);
            localStorage.setItem('analyses', JSON.stringify(analyses));

            // Generate AI-powered analysis
            const analysis = generateAIAnalysis(formData);
            displayAnalysisResult(analysis);
            
            // Update stats
            updateDashboardStats();
        }

        function generateAIAnalysis(data) {
            // Simulate AI analysis based on the data
            let function_analysis = "N√£o identificada";
            let severity = "medium";
            let recommendations = [];

            // Analyze function based on consequences
            if (data.obtainedAttention !== "none") {
                function_analysis = "Busca por Aten√ß√£o";
                recommendations.push("Implementar extin√ß√£o da aten√ß√£o para comportamentos inadequados");
                recommendations.push("Ensinar formas apropriadas de solicitar aten√ß√£o");
            }

            if (data.escapedTask === "yes") {
                function_analysis = "Fuga/Esquiva de Demandas";
                recommendations.push("Reduzir gradualmente a dificuldade das tarefas");
                recommendations.push("Implementar pausas programadas");
            }

            if (data.accessedItem === "yes") {
                function_analysis = "Acesso a Tang√≠veis";
                recommendations.push("Ensinar formas apropriadas de solicitar itens desejados");
                recommendations.push("Implementar sistema de tokens ou recompensas");
            }

            if (data.sensoryOutcome) {
                function_analysis = "Autorregula√ß√£o Sensorial";
                recommendations.push("Fornecer alternativas sensoriais apropriadas");
                recommendations.push("Criar ambiente sensorial adequado");
            }

            // Determine severity
            const intensityNum = parseInt(data.intensity);
            const durationNum = parseFloat(data.duration);
            
            if (intensityNum >= 8 || durationNum >= 30) {
                severity = "high";
            } else if (intensityNum <= 3 && durationNum <= 5) {
                severity = "low";
            }

            // Add general recommendations
            recommendations.push("Monitorar padr√µes atrav√©s de coleta cont√≠nua de dados");
            recommendations.push("Considerar fatores ambientais identificados");
            recommendations.push("Implementar estrat√©gias preventivas baseadas nos antecedentes");

            return {
                function: function_analysis,
                severity: severity,
                recommendations: recommendations,
                patterns: analyzePatterns(data),
                interventions: suggestInterventions(function_analysis, data.diagnosis)
            };
        }

        function analyzePatterns(data) {
            const patterns = [];
            
            // Time-based patterns
            const hour = parseInt(data.timeOfDay.split(':')[0]);
            if (hour < 10) {
                patterns.push("Comportamento ocorre no per√≠odo matutino - considerar fatores como fome ou cansa√ßo");
            } else if (hour > 14) {
                patterns.push("Comportamento ocorre no per√≠odo vespertino - poss√≠vel fadiga ou sobrecarga sensorial");
            }

            // Environment patterns
            if (data.environment === "school") {
                patterns.push("Ambiente escolar pode apresentar desafios espec√≠ficos de demandas acad√™micas");
            }

            // Frequency patterns
            if (parseInt(data.frequency) > 3) {
                patterns.push("Alta frequ√™ncia sugere necessidade de interven√ß√£o imediata");
            }

            return patterns;
        }

        function suggestInterventions(functionAnalysis, diagnosis) {
            const suggestions = [];
            
            switch(functionAnalysis) {
                case "Busca por Aten√ß√£o":
                    suggestions.push("Refor√ßo Diferencial de Comportamento Alternativo (DRA)");
                    suggestions.push("Ensino de Habilidades de Comunica√ß√£o Funcional");
                    break;
                case "Fuga/Esquiva de Demandas":
                    suggestions.push("An√°lise de Tarefas e Modifica√ß√£o de Demandas");
                    suggestions.push("Sistema de Pausas Programadas");
                    break;
                case "Acesso a Tang√≠veis":
                    suggestions.push("Sistema de Economia de Fichas");
                    suggestions.push("Ensino de Solicita√ß√£o Apropriada");
                    break;
                case "Autorregula√ß√£o Sensorial":
                    suggestions.push("Dieta Sensorial Personalizada");
                    suggestions.push("Ambiente Sensorial Controlado");
                    break;
            }

            // Add diagnosis-specific interventions
            if (diagnosis === "autism") {
                suggestions.push("Suporte Visual e Rotinas Estruturadas");
                suggestions.push("Hist√≥rias Sociais");
            } else if (diagnosis === "adhd") {
                suggestions.push("Estrat√©gias de Autorregula√ß√£o");
                suggestions.push("Modifica√ß√µes Ambientais para Aten√ß√£o");
            }

            return suggestions;
        }

        function displayAnalysisResult(analysis) {
            const resultDiv = document.getElementById('analysisResult');
            
            const severityClass = `severity-${analysis.severity}`;
            const severityText = {
                'low': 'Baixa',
                'medium': 'Moderada', 
                'high': 'Alta'
            }[analysis.severity];

            resultDiv.innerHTML = `
                <h3>üéØ Resultado da An√°lise ABC</h3>
                
                <div style="margin: 20px 0;">
                    <h4>Fun√ß√£o Comportamental Identificada:</h4>
                    <p style="font-size: 1.2rem; font-weight: 600; color: #4f46e5;">${analysis.function}</p>
                    <span class="severity-indicator ${severityClass}">Severidade: ${severityText}</span>
                </div>

                <div class="recommendations">
                    <h4>üí° Recomenda√ß√µes Baseadas em IA:</h4>
                    <ul>
                        ${analysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>

                ${analysis.patterns.length > 0 ? `
                <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4>üîç Padr√µes Identificados:</h4>
                    <ul>
                        ${analysis.patterns.map(pattern => `<li>${pattern}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}

                <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4>üéØ Interven√ß√µes Sugeridas:</h4>
                    <ul>
                        ${analysis.interventions.map(intervention => `<li>${intervention}</li>`).join('')}
                    </ul>
                </div>

                <div class="export-options">
                    <button class="btn btn-success" onclick="exportAnalysis()">üìÑ Exportar An√°lise</button>
                    <button class="btn btn-primary" onclick="saveToPatientRecord()">üíæ Salvar no Prontu√°rio</button>
                    <button class="btn btn-warning" onclick="scheduleFollowUp()">üìÖ Agendar Follow-up</button>
                </div>
            `;
            
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function updateIntensityValue(value) {
            document.getElementById('intensityValue').textContent = value;
        }

        function clearForm() {
            document.getElementById('abcForm').reset();
            document.getElementById('analysisResult').style.display = 'none';
            document.getElementById('intensityValue').textContent = '5';
        }

        // Patient management
        function loadPatients() {
            const patientList = document.getElementById('patientList');
            const reportPatientSelect = document.getElementById('reportPatient');
            
            patientList.innerHTML = '';
            reportPatientSelect.innerHTML = '<option value="all">Todos os Pacientes</option>';
            
            patients.forEach(patient => {
                // Add to patient list
                const patientCard = document.createElement('div');
                patientCard.className = 'patient-card';
                patientCard.innerHTML = `
                    <div class="patient-header">
                        <div>
                            <div class="patient-name">${patient.name}</div>
                            <div class="patient-id">ID: ${patient.id} | Idade: ${patient.age} anos</div>
                        </div>
                        <div>
                            <span class="tag">${getDiagnosisLabel(patient.diagnosis)}</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${patient.progress}%"></div>
                    </div>
                    <p style="margin: 10px 0; color: #6b7280;">Progresso: ${patient.progress}%</p>
                    <p style="margin: 10px 0; color: #6b7280;">√öltima sess√£o: ${formatDate(patient.lastSession)}</p>
                    <p style="margin: 10px 0;">${patient.notes}</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="viewPatientDetails(${patient.id})" style="margin-right: 10px;">üëÅÔ∏è Ver Detalhes</button>
                        <button class="btn btn-secondary" onclick="editPatient(${patient.id})">‚úèÔ∏è Editar</button>
                    </div>
                `;
                patientList.appendChild(patientCard);
                
                // Add to report select
                const option = document.createElement('option');
                option.value = patient.id;
                option.textContent = patient.name;
                reportPatientSelect.appendChild(option);
            });
        }

        function getDiagnosisLabel(diagnosis) {
            const labels = {
                'autism': 'TEA',
                'adhd': 'TDAH',
                'intellectual': 'DI',
                'anxiety': 'Ansiedade',
                'other': 'Outro'
            };
            return labels[diagnosis] || diagnosis;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('pt-BR');
        }

        // Patient form handling
        document.getElementById('addPatientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newPatient = {
                id: Date.now(),
                name: document.getElementById('newPatientName').value,
                age: parseInt(document.getElementById('newPatientAge').value),
                diagnosis: document.getElementById('newPatientDiagnosis').value,
                progress: 0,
                lastSession: new Date().toISOString().split('T')[0],
                notes: document.getElementById('newPatientNotes').value
            };
            
            patients.push(newPatient);
            localStorage.setItem('patients', JSON.stringify(patients));
            
            loadPatients();
            updateDashboardStats();
            closeModal('addPatientModal');
            this.reset();
        });

        // Intervention management
        function loadInterventions() {
            const interventionsList = document.getElementById('interventionsList');
            interventionsList.innerHTML = '';
            
            interventions.forEach(intervention => {
                const interventionCard = document.createElement('div');
                interventionCard.className = 'intervention-card';
                interventionCard.innerHTML = `
                    <h4>${intervention.name}</h4>
                    <span class="tag">${getCategoryLabel(intervention.category)}</span>
                    <p style="margin: 10px 0;">${intervention.description}</p>
                    <details style="margin-top: 10px;">
                        <summary style="cursor: pointer; font-weight: 600;">Passos de Implementa√ß√£o</summary>
                        <pre style="white-space: pre-wrap; margin-top: 10px; background: #f8fafc; padding: 10px; border-radius: 5px;">${intervention.steps}</pre>
                    </details>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="useIntervention(${intervention.id})">üéØ Usar Interven√ß√£o</button>
                        <button class="btn btn-secondary" onclick="editIntervention(${intervention.id})">‚úèÔ∏è Editar</button>
                    </div>
                `;
                interventionsList.appendChild(interventionCard);
            });
        }

        function getCategoryLabel(category) {
            const labels = {
                'behavioral': 'Comportamental',
                'communication': 'Comunica√ß√£o',
                'social': 'Social',
                'sensory': 'Sensorial',
                'academic': 'Acad√™mica'
            };
            return labels[category] || category;
        }

        // Intervention form handling
        document.getElementById('addInterventionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newIntervention = {
                id: Date.now(),
                name: document.getElementById('interventionName').value,
                category: document.getElementById('interventionCategory').value,
                description: document.getElementById('interventionDescription').value,
                steps: document.getElementById('interventionSteps').value
            };
            
            interventions.push(newIntervention);
            localStorage.setItem('interventions', JSON.stringify(interventions));
            
            loadInterventions();
            closeModal('addInterventionModal');
            this.reset();
        });

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Dashboard functions
        function updateDashboardStats() {
            document.getElementById('totalPatients').textContent = patients.length;
            document.getElementById('totalAnalyses').textContent = analyses.length;
            
            const avgProgress = patients.length > 0 
                ? Math.round(patients.reduce((sum, p) => sum + p.progress, 0) / patients.length)
                : 0;
            document.getElementById('avgProgress').textContent = avgProgress + '%';
            
            document.getElementById('activeInterventions').textContent = interventions.length;
        }

        function drawProgressChart() {
            const canvas = document.getElementById('progressChart');
            const ctx = canvas.getContext('2d');
            
            // Simple chart drawing
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 20);
            ctx.lineTo(50, 180);
            ctx.lineTo(380, 180);
            ctx.stroke();
            
            // Draw sample data
            const data = [65, 70, 68, 75, 80, 78, 85];
            const colors = ['#4f46e5', '#7c3aed', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
            
            for (let i = 0; i < data.length; i++) {
                const x = 70 + (i * 45);
                const y = 180 - (data[i] * 1.5);
                
                ctx.fillStyle = colors[i % colors.length];
                ctx.fillRect(x - 15, y, 30, 180 - y);
                
                // Labels
                ctx.fillStyle = '#6b7280';
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(`Sem ${i + 1}`, x, 195);
                ctx.fillText(`${data[i]}%`, x, y - 5);
            }
        }

        // Report functions
        function generateReport() {
            const reportResults = document.getElementById('reportResults');
            const reportContent = document.getElementById('reportContent');
            
            const patient = document.getElementById('reportPatient').value;
            const period = document.getElementById('reportPeriod').value;
            const type = document.getElementById('reportType').value;
            
            // Simulate report generation
            reportContent.innerHTML = `
                <h4>üìä Relat√≥rio: ${getReportTypeLabel(type)}</h4>
                <p><strong>Paciente:</strong> ${patient === 'all' ? 'Todos os Pacientes' : getPatientName(patient)}</p>
                <p><strong>Per√≠odo:</strong> ${getPeriodLabel(period)}</p>
                
                <div style="margin: 20px 0; padding: 20px; background: #f8fafc; border-radius: 10px;">
                    <h5>üìà Resumo Executivo</h5>
                    <ul>
                        <li>Total de an√°lises realizadas: ${analyses.length}</li>
                        <li>Comportamentos mais frequentes: Birra/Crise (35%), N√£o-conformidade (28%)</li>
                        <li>Hor√°rios de maior incid√™ncia: 14h-16h (42%)</li>
                        <li>Taxa de melhoria geral: 73%</li>
                    </ul>
                </div>
                
                <div style="margin: 20px 0; padding: 20px; background: #f0f9ff; border-radius: 10px;">
                    <h5>üéØ Recomenda√ß√µes</h5>
                    <ul>
                        <li>Implementar pausas programadas no per√≠odo vespertino</li>
                        <li>Refor√ßar estrat√©gias de comunica√ß√£o funcional</li>
                        <li>Considerar ajustes ambientais para redu√ß√£o de est√≠mulos</li>
                    </ul>
                </div>
            `;
            
            reportResults.style.display = 'block';
        }

        function getReportTypeLabel(type) {
            const labels = {
                'summary': 'Resumo Executivo',
                'detailed': 'An√°lise Detalhada',
                'progress': 'Progresso Comportamental',
                'interventions': 'Efic√°cia das Interven√ß√µes'
            };
            return labels[type] || type;
        }

        function getPeriodLabel(period) {
            const labels = {
                'week': '√öltima Semana',
                'month': '√öltimo M√™s',
                'quarter': '√öltimo Trimestre',
                'custom': 'Per√≠odo Personalizado'
            };
            return labels[period] || period;
        }

        function getPatientName(patientId) {
            const patient = patients.find(p => p.id == patientId);
            return patient ? patient.name : 'Paciente n√£o encontrado';
        }

        // Export functions
        function exportData(format) {
            const currentDate = new Date().toISOString().split('T')[0];
            
            if (format === 'pdf') {
                exportToPDF();
            } else if (format === 'excel') {
                exportToExcel();
            } else if (format === 'csv') {
                exportToCSV();
            }
            
            showNotification(`‚úÖ Dados exportados com sucesso em formato ${format.toUpperCase()}!`, 'success');
        }

        function exportToPDF() {
            // Create PDF content
            const pdfContent = `
                PROTOCOLO ABC NEURODIVERGENTE - RELAT√ìRIO COMPLETO
                ================================================
                Data de Exporta√ß√£o: ${new Date().toLocaleDateString('pt-BR')}
                
                RESUMO GERAL
                ------------
                Total de Pacientes: ${patients.length}
                Total de An√°lises: ${analyses.length}
                Total de Interven√ß√µes: ${interventions.length}
                
                PACIENTES CADASTRADOS
                --------------------
                ${patients.map(p => `
                Nome: ${p.name}
                Idade: ${p.age} anos
                Diagn√≥stico: ${getDiagnosisLabel(p.diagnosis)}
                Progresso: ${p.progress}%
                √öltima Sess√£o: ${formatDate(p.lastSession)}
                Observa√ß√µes: ${p.notes}
                ----------------------------------------`).join('\n')}
                
                AN√ÅLISES COMPORTAMENTAIS RECENTES
                --------------------------------
                ${analyses.slice(-10).map(a => `
                Paciente: ${a.patientName}
                Data: ${formatDate(a.timestamp)}
                Comportamento: ${a.behaviorType}
                Intensidade: ${a.intensity}/10
                Dura√ß√£o: ${a.duration} minutos
                Descri√ß√£o: ${a.behaviorDescription}
                ----------------------------------------`).join('\n')}
                
                INTERVEN√á√ïES DISPON√çVEIS
                -----------------------
                ${interventions.map(i => `
                Nome: ${i.name}
                Categoria: ${getCategoryLabel(i.category)}
                Descri√ß√£o: ${i.description}
                ----------------------------------------`).join('\n')}
                
                Relat√≥rio gerado automaticamente pelo Sistema Protocolo ABC Neurodivergente
            `;
            
            const blob = new Blob([pdfContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `protocolo_abc_relatorio_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
        }

        function exportToExcel() {
            // Create Excel-compatible CSV with tabs
            let excelContent = "PROTOCOLO ABC NEURODIVERGENTE - DADOS COMPLETOS\n\n";
            
            // Patients sheet
            excelContent += "PACIENTES\n";
            excelContent += "ID\tNome\tIdade\tDiagn√≥stico\tProgresso\t√öltima Sess√£o\tObserva√ß√µes\n";
            patients.forEach(p => {
                excelContent += `${p.id}\t${p.name}\t${p.age}\t${getDiagnosisLabel(p.diagnosis)}\t${p.progress}%\t${formatDate(p.lastSession)}\t${p.notes}\n`;
            });
            
            excelContent += "\n\nAN√ÅLISES COMPORTAMENTAIS\n";
            excelContent += "Paciente\tData\tHor√°rio\tComportamento\tIntensidade\tDura√ß√£o\tFrequ√™ncia\tDescri√ß√£o\tAmbiente\n";
            analyses.forEach(a => {
                excelContent += `${a.patientName}\t${formatDate(a.timestamp)}\t${a.timeOfDay}\t${a.behaviorType}\t${a.intensity}\t${a.duration}\t${a.frequency}\t${a.behaviorDescription.replace(/\n/g, ' ')}\t${a.environment}\n`;
            });
            
            excelContent += "\n\nINTERVEN√á√ïES\n";
            excelContent += "ID\tNome\tCategoria\tDescri√ß√£o\tPassos\n";
            interventions.forEach(i => {
                excelContent += `${i.id}\t${i.name}\t${getCategoryLabel(i.category)}\t${i.description.replace(/\n/g, ' ')}\t${i.steps.replace(/\n/g, ' | ')}\n`;
            });
            
            const blob = new Blob([excelContent], { type: 'application/vnd.ms-excel;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `protocolo_abc_dados_${new Date().toISOString().split('T')[0]}.xls`;
            link.click();
        }

        function exportToCSV() {
            // Create proper CSV format
            let csvContent = "";
            
            // Patients CSV
            csvContent += "PACIENTES\n";
            csvContent += "ID,Nome,Idade,Diagn√≥stico,Progresso,√öltima Sess√£o,Observa√ß√µes\n";
            patients.forEach(p => {
                csvContent += `${p.id},"${p.name}",${p.age},"${getDiagnosisLabel(p.diagnosis)}","${p.progress}%","${formatDate(p.lastSession)}","${p.notes.replace(/"/g, '""')}"\n`;
            });
            
            csvContent += "\n\nAN√ÅLISES COMPORTAMENTAIS\n";
            csvContent += "Paciente,Data,Hor√°rio,Comportamento,Intensidade,Dura√ß√£o,Frequ√™ncia,Descri√ß√£o,Ambiente\n";
            analyses.forEach(a => {
                csvContent += `"${a.patientName}","${formatDate(a.timestamp)}","${a.timeOfDay}","${a.behaviorType}",${a.intensity},${a.duration},${a.frequency},"${a.behaviorDescription.replace(/"/g, '""')}","${a.environment}"\n`;
            });
            
            csvContent += "\n\nINTERVEN√á√ïES\n";
            csvContent += "ID,Nome,Categoria,Descri√ß√£o,Passos\n";
            interventions.forEach(i => {
                csvContent += `${i.id},"${i.name}","${getCategoryLabel(i.category)}","${i.description.replace(/"/g, '""')}","${i.steps.replace(/"/g, '""').replace(/\n/g, ' | ')}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `protocolo_abc_dados_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function exportAnalysis() {
            alert('üìÑ An√°lise exportada com sucesso!');
        }

        function saveToPatientRecord() {
            alert('üíæ An√°lise salva no prontu√°rio do paciente!');
        }

        function scheduleFollowUp() {
            alert('üìÖ Follow-up agendado com sucesso!');
        }

        // Patient detail functions
        function viewPatientDetails(patientId) {
            const patient = patients.find(p => p.id === patientId);
            if (!patient) return;
            
            const patientAnalyses = analyses.filter(a => a.patientName.toLowerCase().includes(patient.name.toLowerCase()));
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
                    <h3>üë§ Detalhes do Paciente: ${patient.name}</h3>
                    
                    <div class="form-grid">
                        <div class="form-section">
                            <h4>üìã Informa√ß√µes B√°sicas</h4>
                            <p><strong>Nome:</strong> ${patient.name}</p>
                            <p><strong>Idade:</strong> ${patient.age} anos</p>
                            <p><strong>Diagn√≥stico:</strong> ${getDiagnosisLabel(patient.diagnosis)}</p>
                            <p><strong>Progresso:</strong> ${patient.progress}%</p>
                            <p><strong>√öltima Sess√£o:</strong> ${formatDate(patient.lastSession)}</p>
                            <p><strong>Observa√ß√µes:</strong> ${patient.notes}</p>
                        </div>
                        
                        <div class="form-section">
                            <h4>üìä Estat√≠sticas</h4>
                            <p><strong>Total de An√°lises:</strong> ${patientAnalyses.length}</p>
                            <p><strong>Comportamentos Registrados:</strong> ${getUniqueBehaiors(patientAnalyses).length}</p>
                            <p><strong>√öltima An√°lise:</strong> ${patientAnalyses.length > 0 ? formatDate(patientAnalyses[patientAnalyses.length - 1].timestamp) : 'Nenhuma'}</p>
                        </div>
                    </div>
                    
                    <div class="behavior-timeline">
                        <h4>üìà Hist√≥rico Recente</h4>
                        ${patientAnalyses.slice(-5).map(analysis => `
                            <div class="timeline-item">
                                <div class="timeline-time">${formatDate(analysis.timestamp)}</div>
                                <div class="timeline-content">
                                    <strong>${analysis.behaviorType}</strong> - Intensidade: ${analysis.intensity}/10
                                    <br><small>${analysis.behaviorDescription.substring(0, 100)}...</small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="editPatient(${patientId}); this.closest('.modal').remove();">‚úèÔ∏è Editar Paciente</button>
                        <button class="btn btn-success" onclick="generatePatientReport(${patientId}); this.closest('.modal').remove();">üìä Gerar Relat√≥rio</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getUniqueBehaiors(patientAnalyses) {
            return [...new Set(patientAnalyses.map(a => a.behaviorType))];
        }

        function editPatient(patientId) {
            const patient = patients.find(p => p.id === patientId);
            if (!patient) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
                    <h3>‚úèÔ∏è Editar Paciente</h3>
                    <form id="editPatientForm">
                        <div class="form-group">
                            <label>Nome Completo</label>
                            <input type="text" id="editPatientName" class="form-control" value="${patient.name}" required>
                        </div>
                        <div class="form-group">
                            <label>Idade</label>
                            <input type="number" id="editPatientAge" class="form-control" value="${patient.age}" required>
                        </div>
                        <div class="form-group">
                            <label>Diagn√≥stico</label>
                            <select id="editPatientDiagnosis" class="form-control" required>
                                <option value="autism" ${patient.diagnosis === 'autism' ? 'selected' : ''}>Transtorno do Espectro Autista</option>
                                <option value="adhd" ${patient.diagnosis === 'adhd' ? 'selected' : ''}>TDAH</option>
                                <option value="intellectual" ${patient.diagnosis === 'intellectual' ? 'selected' : ''}>Defici√™ncia Intelectual</option>
                                <option value="anxiety" ${patient.diagnosis === 'anxiety' ? 'selected' : ''}>Transtorno de Ansiedade</option>
                                <option value="other" ${patient.diagnosis === 'other' ? 'selected' : ''}>Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Progresso (%)</label>
                            <input type="range" id="editPatientProgress" class="form-control" min="0" max="100" value="${patient.progress}" oninput="document.getElementById('editProgressValue').textContent = this.value + '%'">
                            <span id="editProgressValue">${patient.progress}%</span>
                        </div>
                        <div class="form-group">
                            <label>Observa√ß√µes</label>
                            <textarea id="editPatientNotes" class="form-control">${patient.notes}</textarea>
                        </div>
                        <div style="text-align: center;">
                            <button type="submit" class="btn btn-primary">üíæ Salvar Altera√ß√µes</button>
                            <button type="button" class="btn btn-danger" onclick="deletePatient(${patientId}); this.closest('.modal').remove();" style="margin-left: 10px;">üóëÔ∏è Excluir Paciente</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('editPatientForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const patientIndex = patients.findIndex(p => p.id === patientId);
                patients[patientIndex] = {
                    ...patients[patientIndex],
                    name: document.getElementById('editPatientName').value,
                    age: parseInt(document.getElementById('editPatientAge').value),
                    diagnosis: document.getElementById('editPatientDiagnosis').value,
                    progress: parseInt(document.getElementById('editPatientProgress').value),
                    notes: document.getElementById('editPatientNotes').value
                };
                
                localStorage.setItem('patients', JSON.stringify(patients));
                loadPatients();
                updateDashboardStats();
                modal.remove();
                
                showNotification('‚úÖ Paciente atualizado com sucesso!', 'success');
            });
        }

        function deletePatient(patientId) {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja excluir este paciente? Esta a√ß√£o n√£o pode ser desfeita.')) {
                patients = patients.filter(p => p.id !== patientId);
                localStorage.setItem('patients', JSON.stringify(patients));
                loadPatients();
                updateDashboardStats();
                showNotification('üóëÔ∏è Paciente exclu√≠do com sucesso!', 'success');
            }
        }

        function generatePatientReport(patientId) {
            const patient = patients.find(p => p.id === patientId);
            const patientAnalyses = analyses.filter(a => a.patientName.toLowerCase().includes(patient.name.toLowerCase()));
            
            const reportData = {
                patient: patient,
                analyses: patientAnalyses,
                totalAnalyses: patientAnalyses.length,
                avgIntensity: patientAnalyses.length > 0 ? (patientAnalyses.reduce((sum, a) => sum + parseInt(a.intensity), 0) / patientAnalyses.length).toFixed(1) : 0,
                mostCommonBehavior: getMostCommonBehavior(patientAnalyses),
                progressTrend: calculateProgressTrend(patientAnalyses)
            };
            
            const reportBlob = new Blob([JSON.stringify(reportData, null, 2)], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(reportBlob);
            link.download = `relatorio_${patient.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('üìä Relat√≥rio do paciente gerado com sucesso!', 'success');
        }

        function getMostCommonBehavior(analyses) {
            if (analyses.length === 0) return 'Nenhum';
            const behaviors = analyses.map(a => a.behaviorType);
            const counts = {};
            behaviors.forEach(b => counts[b] = (counts[b] || 0) + 1);
            return Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
        }

        function calculateProgressTrend(analyses) {
            if (analyses.length < 2) return 'Insuficiente';
            const recent = analyses.slice(-5);
            const older = analyses.slice(-10, -5);
            
            const recentAvg = recent.reduce((sum, a) => sum + parseInt(a.intensity), 0) / recent.length;
            const olderAvg = older.length > 0 ? older.reduce((sum, a) => sum + parseInt(a.intensity), 0) / older.length : recentAvg;
            
            if (recentAvg < olderAvg) return 'Melhorando';
            if (recentAvg > olderAvg) return 'Piorando';
            return 'Est√°vel';
        }

        function useIntervention(interventionId) {
            const intervention = interventions.find(i => i.id === interventionId);
            if (!intervention) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
                    <h3>üéØ Aplicar Interven√ß√£o: ${intervention.name}</h3>
                    
                    <div class="form-section">
                        <h4>üìã Detalhes da Interven√ß√£o</h4>
                        <p><strong>Categoria:</strong> ${getCategoryLabel(intervention.category)}</p>
                        <p><strong>Descri√ß√£o:</strong> ${intervention.description}</p>
                    </div>
                    
                    <div class="form-section">
                        <h4>üìù Passos de Implementa√ß√£o</h4>
                        <pre style="white-space: pre-wrap; background: #f8fafc; padding: 15px; border-radius: 8px; border-left: 4px solid #4f46e5;">${intervention.steps}</pre>
                    </div>
                    
                    <form id="applyInterventionForm">
                        <div class="form-group">
                            <label>Selecionar Paciente</label>
                            <select id="interventionPatient" class="form-control" required>
                                <option value="">Selecione um paciente...</option>
                                ${patients.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Data de In√≠cio</label>
                            <input type="date" id="interventionStartDate" class="form-control" value="${new Date().toISOString().split('T')[0]}" required>
                        </div>
                        <div class="form-group">
                            <label>Observa√ß√µes Iniciais</label>
                            <textarea id="interventionNotes" class="form-control" placeholder="Observa√ß√µes sobre a aplica√ß√£o da interven√ß√£o..."></textarea>
                        </div>
                        <div style="text-align: center;">
                            <button type="submit" class="btn btn-primary">üöÄ Iniciar Interven√ß√£o</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('applyInterventionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const applicationData = {
                    id: Date.now(),
                    interventionId: interventionId,
                    patientId: parseInt(document.getElementById('interventionPatient').value),
                    startDate: document.getElementById('interventionStartDate').value,
                    notes: document.getElementById('interventionNotes').value,
                    status: 'active'
                };
                
                let appliedInterventions = JSON.parse(localStorage.getItem('appliedInterventions')) || [];
                appliedInterventions.push(applicationData);
                localStorage.setItem('appliedInterventions', JSON.stringify(appliedInterventions));
                
                modal.remove();
                showNotification('üéØ Interven√ß√£o iniciada com sucesso!', 'success');
            });
        }

        function editIntervention(interventionId) {
            const intervention = interventions.find(i => i.id === interventionId);
            if (!intervention) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal" onclick="this.closest('.modal').remove()">&times;</span>
                    <h3>‚úèÔ∏è Editar Interven√ß√£o</h3>
                    <form id="editInterventionForm">
                        <div class="form-group">
                            <label>Nome da Interven√ß√£o</label>
                            <input type="text" id="editInterventionName" class="form-control" value="${intervention.name}" required>
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <select id="editInterventionCategory" class="form-control" required>
                                <option value="behavioral" ${intervention.category === 'behavioral' ? 'selected' : ''}>Comportamental</option>
                                <option value="communication" ${intervention.category === 'communication' ? 'selected' : ''}>Comunica√ß√£o</option>
                                <option value="social" ${intervention.category === 'social' ? 'selected' : ''}>Habilidades Sociais</option>
                                <option value="sensory" ${intervention.category === 'sensory' ? 'selected' : ''}>Sensorial</option>
                                <option value="academic" ${intervention.category === 'academic' ? 'selected' : ''}>Acad√™mica</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <textarea id="editInterventionDescription" class="form-control" required>${intervention.description}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Passos da Implementa√ß√£o</label>
                            <textarea id="editInterventionSteps" class="form-control" required>${intervention.steps}</textarea>
                        </div>
                        <div style="text-align: center;">
                            <button type="submit" class="btn btn-primary">üíæ Salvar Altera√ß√µes</button>
                            <button type="button" class="btn btn-danger" onclick="deleteIntervention(${interventionId}); this.closest('.modal').remove();" style="margin-left: 10px;">üóëÔ∏è Excluir Interven√ß√£o</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('editInterventionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const interventionIndex = interventions.findIndex(i => i.id === interventionId);
                interventions[interventionIndex] = {
                    ...interventions[interventionIndex],
                    name: document.getElementById('editInterventionName').value,
                    category: document.getElementById('editInterventionCategory').value,
                    description: document.getElementById('editInterventionDescription').value,
                    steps: document.getElementById('editInterventionSteps').value
                };
                
                localStorage.setItem('interventions', JSON.stringify(interventions));
                loadInterventions();
                modal.remove();
                
                showNotification('‚úÖ Interven√ß√£o atualizada com sucesso!', 'success');
            });
        }

        function deleteIntervention(interventionId) {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja excluir esta interven√ß√£o? Esta a√ß√£o n√£o pode ser desfeita.')) {
                interventions = interventions.filter(i => i.id !== interventionId);
                localStorage.setItem('interventions', JSON.stringify(interventions));
                loadInterventions();
                showNotification('üóëÔ∏è Interven√ß√£o exclu√≠da com sucesso!', 'success');
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#4f46e5'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: 600;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'985f2dce14cbc2f3',t:'MTc1OTAxOTkxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
